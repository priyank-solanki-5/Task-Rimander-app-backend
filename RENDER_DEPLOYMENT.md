# Render Deployment Guide for Task Reminder Backend

## Quick Deploy to Render

### Option 1: Deploy via GitHub (Recommended)

1. **Push your code to GitHub**
   ```bash
   git add .
   git commit -m "Add Render deployment config"
   git push origin main
   ```

2. **Connect to Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Render will auto-detect the `render.yaml` configuration

3. **Set Environment Variables**
   - `MongoDB_URL`: Your MongoDB connection string
   - `ADMIN_API_KEY`: Your admin key (e.g., `admin-internal-key-2026`)
   - `JWT_SECRET`: Will be auto-generated

### Option 2: Manual Deploy

1. **Create New Web Service**
   - Go to Render Dashboard
   - Click "New +" → "Web Service"
   - Connect repository or use public Git URL

2. **Configure Build Settings**
   - **Name**: `task-reminder-api`
   - **Region**: Oregon (US West) or closest to you
   - **Branch**: `main`
   - **Build Command**: `cd backend && npm install`
   - **Start Command**: `cd backend && node server.js`
   - **Plan**: Free

3. **Set Environment Variables**
   ```
   NODE_ENV=production
   PORT=3000
   MongoDB_URL=<your-mongodb-connection-string>
   JWT_SECRET=<auto-generated-or-custom>
   ADMIN_API_KEY=admin-internal-key-2026
   ```

4. **Deploy**
   - Click "Create Web Service"
   - Wait for deployment (3-5 minutes)

## Cron Job Configuration

The backend includes built-in cron jobs that run automatically:

### 1. Keep-Alive Job (Every 10 minutes)
- **Purpose**: Prevents Render free tier from sleeping
- **Schedule**: `*/10 * * * *` (every 10 minutes)
- **Action**: Logs activity to keep service active 

### 2. Notification Check (Every 6 hours)
- **Schedule**: `0 0,6,12,18 * * *`
- **Action**: Checks and creates notifications for tasks

### 3. Daily Overdue Check (8 AM daily)
- **Schedule**: `0 8 * * *`
- **Action**: Checks for overdue tasks

## External Cron Job (Optional)

For additional reliability, set up an external cron job service:

### Using cron-job.org (Free)

1. Go to [cron-job.org](https://cron-job.org/)
2. Create account and add new cron job
3. **URL**: `https://your-app.onrender.com/keep-alive`
4. **Schedule**: Every 10 minutes
5. **Method**: GET

### Using UptimeRobot (Free)

1. Go to [UptimeRobot](https://uptimerobot.com/)
2. Add new monitor
3. **Monitor Type**: HTTP(s)
4. **URL**: `https://your-app.onrender.com/health`
5. **Monitoring Interval**: 5 minutes

### Using EasyCron (Free tier)

1. Go to [EasyCron](https://www.easycron.com/)
2. Add new cron job
3. **URL**: `https://your-app.onrender.com/keep-alive`
4. **Cron Expression**: `*/10 * * * *`

## Health Check Endpoints

- **`/health`**: Basic health check with uptime
- **`/keep-alive`**: Keep-alive endpoint for external pings

Test after deployment:
```bash
curl https://your-app.onrender.com/health
curl https://your-app.onrender.com/keep-alive
```

## Important Notes

### Render Free Tier Limitations
- Service spins down after 15 minutes of inactivity
- First request after spin-down takes 30-60 seconds
- 750 hours/month free (enough for 1 service running 24/7)

### Cold Start Prevention
- Internal cron job runs every 10 minutes
- External cron service pings every 5-10 minutes
- Both together ensure < 15 minutes idle time

### Expected Response Times
- **Cold start**: 30-60 seconds (first request after sleep)
- **Warm service**: < 1 second
- **After cron setup**: Always < 1 second

## Monitoring Your Service

1. **Render Dashboard**: Check logs and metrics
2. **Health endpoint**: `https://your-app.onrender.com/health`
3. **Uptime monitoring**: Use UptimeRobot for alerts

## Troubleshooting

### Service still sleeps
- Verify internal cron jobs are running (check logs)
- Add external cron job as backup
- Check Render logs for errors

### Slow response times
- First request after deploy is always slow (cold start)
- Subsequent requests should be fast
- Consider upgrading to paid plan for instant response

### MongoDB connection issues
- Verify MongoDB_URL in environment variables
- Check MongoDB Atlas IP whitelist (allow all: 0.0.0.0/0)
- Ensure MongoDB cluster is active

## Your Deployed URL

After deployment, your API will be available at:
```
https://task-reminder-api.onrender.com
```

Update your frontend `.env` file:
```
VITE_API_URL=https://task-reminder-api.onrender.com/api
```

## Next Steps

1. Deploy backend to Render
2. Note your deployed URL
3. Set up external cron job (optional but recommended)
4. Update frontend environment variables
5. Deploy frontend (Vercel/Netlify)
6. Test the complete application

---

**Need Help?**
- [Render Documentation](https://render.com/docs)
- [Render Support](https://render.com/support)
- Check backend logs in Render Dashboard
